FROM iron/go:dev

ARG BUILD_DATE
ARG VERSION
ARG SERVICEPORT
ARG CONTAINER

EXPOSE ${SERVICEPORT}

ENV WDIR /go/src/app
ENV PATH $WDIR:$PATH

WORKDIR ${WDIR}

LABEL BUILD_DATE ${BUILD_DATE}
LABEL VERSION ${VERSION}
LABEL CONTAINER ${CONTAINER}

ADD . ${WDIR}
RUN go get github.com/gocql/gocql
RUN CGO_ENABLED=0 GOOS=linux go build -o ${CONTAINER} service.go

ENTRYPOINT ["${WDIR}/${CONTAINER}"]
